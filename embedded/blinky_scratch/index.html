<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Blinky LED from Scratch</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-HFNGDFK1PN"></script><script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag(&#x27;js&#x27;, new Date());

        gtag(&#x27;config&#x27;, &#x27;G-HFNGDFK1PN&#x27;);
        </script><meta name="next-head-count" content="5"/><link rel="preload" href="/blogs/_next/static/css/a0de50ea0cc40a66.css" as="style"/><link rel="stylesheet" href="/blogs/_next/static/css/a0de50ea0cc40a66.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blogs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/blogs/_next/static/chunks/webpack-b7c95b972d7a52a1.js" defer=""></script><script src="/blogs/_next/static/chunks/framework-a85322f027b40e20.js" defer=""></script><script src="/blogs/_next/static/chunks/main-25a9149b204a716f.js" defer=""></script><script src="/blogs/_next/static/chunks/pages/_app-ae69650375182de2.js" defer=""></script><script src="/blogs/_next/static/chunks/253-8360a865f593540b.js" defer=""></script><script src="/blogs/_next/static/chunks/pages/embedded/blinky_scratch-d6fa6a5b644a848f.js" defer=""></script><script src="/blogs/_next/static/x4tWifcy7VyKappZHO2tO/_buildManifest.js" defer=""></script><script src="/blogs/_next/static/x4tWifcy7VyKappZHO2tO/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><article class="nx-container nx-prose max-md:nx-prose-sm dark:nx-prose-dark" dir="ltr"><h1>Blinky LED from Scratch</h1><div class="nx-mb-8 nx-flex nx-gap-3 nx-items-center"><div class="nx-grow dark:nx-text-gray-400 nx-text-gray-600"><div class="nx-not-prose nx-flex nx-flex-wrap nx-items-center nx-gap-1"></div></div><div class="nx-flex nx-items-center nx-gap-3 print:nx-hidden"></div></div><div style="text-align:justify"><p>There are a lot of libraries that allow you to write code from a very abstracted perspective. There&#x27;s STM&#x27;s own library (can be found on GitHub, or through their code generation tool STM32CubeMX), and then there&#x27;s also <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">libopencm3</code> for Cortex-M CPUs.</p><p>All work excellently. No doubt. But, as they are libraries, they abstract away the internals. It doesn&#x27;t answer the question: What if you were to start writing ARM assembly directly? How would you “push” the code to the chip? How will it run it? What if I want to make an OS for ARM without the use of external libraries, and want to test it on my device?</p><p>The root of the questions like this and other similar queries are answered here.</p><h2 class="nx-not-prose subheading-h2">Blinky LED C program<a href="#blinky-led-c-program" id="blinky-led-c-program" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><p>First, we&#x27;ll be creating a blinky LED C program. The target board is a STM32 Nucleo F446RE. For other STM32 boards, the only things that would differ are memory addresses. For other microcontrollers, the main logic would remain the same, but the implementation might differ. Please refer the reference manual of the microcontroller for details.</p><p>For reference, the green LED present on this Nucleo board is called LD2 and is mapped to Port 5 of GPIO A (<code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">PA_5</code>).</p><h2 class="nx-not-prose subheading-h2">RCC Clock Enable<a href="#rcc-clock-enable" id="rcc-clock-enable" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><p>GPIOA (and other GPIO ports) have their memory mapped to AHB1 (Advanced High-performance Bus) according to the memory map in the reference manual. The (System) Reset and Clock Control (RCC) register group has a particular register that is of interest here called <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">RCC_AHB1ENR</code>, which controls the status of the clock for AHB1. The bit 0 of this register is for GPIOA and is called <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GPIOAEN</code>. We need to enable this to allow the GPIOA to have a clock. In other words, we are enabling GPIOA itself.</p><p>The address range for RCC according to the memory map table in the reference manual is <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0x40023800</code> to <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0x40023BFF</code>. Further, the <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">RCC_AHB1ENR</code> has an offset of <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0x30</code>, which means it’s at <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0x40023830</code>. We have to enable the bit <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0</code> of it. Bit <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0</code> in ARM means the Least Significant Bit (LSB).</p><p>Setting up the addresses:</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="c" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="c" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">#include</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&lt;stdint.h&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-comment)">// Required for uint32_t</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">#define</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">RCC_BASE_ADDR</span><span style="color:var(--shiki-color-text)">   </span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">40023800</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">#define</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">RCC_AHB1ENR</span><span style="color:var(--shiki-color-text)">     (</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">volatile</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">uint32_t</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">)(RCC_BASE_ADDR </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">30</span><span style="color:var(--shiki-color-text)">))</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p>Enabling it:</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="c" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="c" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-color-text)">() {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  RCC_AHB1ENR </span><span style="color:var(--shiki-token-keyword)">|=</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&lt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><h3 class="nx-not-prose subheading-h3">C Basics<a href="#c-basics" id="c-basics" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>First, a number starting with <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0x</code> is a hex number.</p><p>Second, the pointer stores the memory address like <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">uint32_t *p = 0x40023830;</code>, and hence when we want to read/write something to a particular memory address, we use a pointer to it to do the operation. As simple as <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">*p = value;</code> or <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">int x = *p;</code>.</p><p>Third, the compiler likes to optimize a lot of things, ESPECIALLY hard-coded numbers. If you try to do:</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="c" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="c" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-color-text)">() {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">uint32_t</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">p </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">40023830</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)"> x </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">p;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p>The compiler tries to optimize a lot of things. It will try to optimize this piece of code as well. We don’t want that, even if “optimized” sounds better.</p><p>The thing is, the value stored in the location pointed by the compiler can update in various mysterious ways that’s dependent on your use-case. Writing to a memory location may have a side-effect outside of your program, eg. blinking an LED (ie. outputting something from PA_5).</p><p>The compiler doesn’t know this. It just knows how you’re using the pointer - a variable - inside the program itself. It doesn’t seem to be doing anything useful, according to the compiler. No printing it to screen, no way you’re actually even using the pointer other than reading a value from it. The compiler can consider the variable useless, and remove it all together. Worse, it can try to cache the values. So your memory might be updated by something else (for example, I/O), and you might still get old values.</p><p>Optimizations of this kind are prevented by using the <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">volatile</code> keyword.</p><p>Fourth, to set a bit at position i (0-indexing) in a number (preferably unsigned) <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">n</code>, we need to do <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">n = n | (1 &lt;&lt; i)</code>, or <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">n |= (1 &lt;&lt; i)</code>.</p><p>Fifth, to reset a bit at position <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">i</code> (0-indexing) in a number n, we need to do <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">n &amp;= ~(1 &lt;&lt; i)</code>.</p><h2 class="nx-not-prose subheading-h2">GPIO Registers<a href="#gpio-registers" id="gpio-registers" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><h3 class="nx-not-prose subheading-h3">GPIO Mode Register<a href="#gpio-mode-register" id="gpio-mode-register" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>According to STM32 reference manual for the target board, the GPIO Mode Registers (<code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GPIOx_MODER</code>) decide the mode the particular pin is operating in. It also states that, for enabling output mode, we need to write 0b01 to the register corresponding to <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">PA_5</code>.</p><p>The reference manual states that the GPIOA base address in AHB1 is <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0x40020000</code> and the offset for <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GPIOA_MODER</code> is <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0x0</code>, which makes it <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0x40020000</code>. Each pin has 2 bits for itself, and <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">PA_5</code> has bits 10 &amp; 11 for itself.</p><p>First we declare the addresses:</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="c" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="c" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">#define</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">GPIOA_BASE_ADDR</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">40020000</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">#define</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">GPIOA_MODER</span><span style="color:var(--shiki-color-text)">     (</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">volatile</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">uint32_t</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">)(GPIOA_BASE_ADDR </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">00</span><span style="color:var(--shiki-color-text)">))</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p>Then we reset the 10th and 11th bits, and set them as <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0b01</code>:</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="c" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="c" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-color-text)">() {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    GPIOA_MODER </span><span style="color:var(--shiki-token-keyword)">&amp;=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">~</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&lt;</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">5</span><span style="color:var(--shiki-color-text)">));</span><span style="color:var(--shiki-token-comment)"> // 0x3 is 0b11, and we&#x27;re negating to reset bits</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    GPIOA_MODER </span><span style="color:var(--shiki-token-keyword)">|=</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&lt;</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">5</span><span style="color:var(--shiki-color-text)">));</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><h3 class="nx-not-prose subheading-h3">GPIO Output Data Register<a href="#gpio-output-data-register" id="gpio-output-data-register" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>The register <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GPIOA_ODR</code> is responsible for holding the bits for outputting HIGH (1) or LOW (0) through the various pins. By a similar method as <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GPIOA_MODER</code>, the address for GPIOA_ODR comes out as <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0x40020014</code>, and the bit at position <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">5</code> is responsible for PA_5.</p><p>Thus, turning LD2 (PA_5) ON and OFF:</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="c" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="c" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-color-text)">() {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  GPIOA_ODR </span><span style="color:var(--shiki-token-keyword)">|=</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&lt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">5</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p>A toggling can be used instead (default state is <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0</code>) like: <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GPIOA_ODR ^= (1 &lt;&lt; 5);</code></p><h2 class="nx-not-prose subheading-h2">Delay<a href="#delay" id="delay" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><p>A delay can be introduced like:</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="c" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="c" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-color-text)">() {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">for</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">volatile</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">uint32_t</span><span style="color:var(--shiki-color-text)"> i </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">; i </span><span style="color:var(--shiki-token-keyword)">&lt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">100000</span><span style="color:var(--shiki-color-text)">; i</span><span style="color:var(--shiki-token-keyword)">++</span><span style="color:var(--shiki-color-text)">) { </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-comment)">// Simple delay loop</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    }</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p>We don’t have to worry about the loop being optimized (and removed), even if technically it’s not doing anything, as we’re using <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">volatile</code> for <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">i</code>.</p><h2 class="nx-not-prose subheading-h2">Vector Table<a href="#vector-table" id="vector-table" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><p>Vector table is a table that is supposed to be at the start of the flash memory. Without the vector table, the program will not even start executing, so it is arguably the most important part of this process. The vector table needs to be loaded at the start of the flash and it has some important pieces of information that is read by the CPU.</p><p>Since it needs to be at a particular address, the linker comes into play. We reserve a custom section called <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">.vectors</code>, which is kept at the start. It’s supposed to be part of <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">.text</code>, so we keep it like this here. It can also be kept in a separate section.</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="text" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="text" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">SECTIONS</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	.text : {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		*(.vectors)	/* Vector table */</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		*(.text*)	/* Program code */</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		/* ... */</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	} &gt; FLASH</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	/* ... */</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p>In the C code, we’ll attach the <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">__attribute__ ((section(&quot;.vectors&quot;)))</code> attribute to the vector table that we define, so that linker put that in the required location.</p><p>The vector table contains addresses for handlers that will handle exceptions, interrupts, etc. Since these don’t contain the exact handler itself, just its pointer, the handler can be customized.</p><p>Usually libraries will use a <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">__attribute__ ((weak))</code> with their default implementations in case the programmer wants to customize it.</p><h3 class="nx-not-prose subheading-h3">Stack Pointer<a href="#stack-pointer" id="stack-pointer" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>In the ARM Cortex-M4 reference manual, it’s mentioned that the 32-bit value stored at <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0x00000000</code> is read into the stack pointer at reset.</p><p>We need the value of the address of the start of stack pointer from the linker script:</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="text" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="text" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">PROVIDE(_stack = ORIGIN(SRAM) + LENGTH(SRAM));</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p><strong>The stack grows downward.</strong></p><p><strong>NOTE: Linker has it’s own way of writing a symbol table using variable’s values as their addresses. So &amp;_stack will give you the value of the address you’re looking for.</strong></p><h3 class="nx-not-prose subheading-h3">Reset<a href="#reset" id="reset" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>The address which will be loaded for reset is kept at <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">0x00000004</code> and is a 32-bit value.</p><h3 class="nx-not-prose subheading-h3">Others<a href="#others" id="others" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>There are other important exception handlers like NMI handler, Memory management fault, etc. followed by the Interrupt Request (IRQ) handlers, all of which can be customized. Theoretically, the IRQ does not have any limit to the number of handlers it has. It can be programmed to have as many as the programmer likes. The reset address is recommended to start right after the table ends.</p><p><strong>NOTE: The addresses have to be 4-aligned. If the space taken is less (like in the case of .text section) then the linker script needs to tell the linker to align to the nearest greater multiple of 4.</strong></p><h3 class="nx-not-prose subheading-h3">Final Vector Table<a href="#final-vector-table" id="final-vector-table" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="c" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="c" data-theme="default"><span class="line"><span style="color:var(--shiki-token-function)">__attribute__</span><span style="color:var(--shiki-color-text)"> ((</span><span style="color:var(--shiki-token-function)">section</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;.vectors&quot;</span><span style="color:var(--shiki-color-text)">))) </span><span style="color:var(--shiki-token-keyword)">void</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">vectors</span><span style="color:var(--shiki-token-keyword)">[]</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-color-text)">_stack</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-color-text)">main</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">};</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p>Except the first entry, all the others are function pointers (for handlers), and here the reset handler is simply <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">main</code>. This means that the entry point of the processor indirectly will be main. A lot of the times, you want a reset handler which will copy data from flash to RAM, set up BSS to 0, some CPU-specific prerequisites, and call main inside it.</p><p>A lot of implementations of the vector table are of the form of struct, but as this is minimal and not built for maintainability and readability, an array would suffice.</p><h2 class="nx-not-prose subheading-h2">Flashing<a href="#flashing" id="flashing" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><p>A cross compiler can be used to convert the program into an ELF and a binary (I have a document on cross compilation, so this will be short).</p><p>The full program:</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="c" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="c" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">#include</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&lt;stdint.h&gt;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">#define</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">RCC_BASE_ADDR</span><span style="color:var(--shiki-color-text)">   </span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">40023800</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">#define</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">GPIOA_BASE_ADDR</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">40020000</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">#define</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">RCC_AHB1ENR</span><span style="color:var(--shiki-color-text)">     (</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">volatile</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">uint32_t</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">)(RCC_BASE_ADDR </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">30</span><span style="color:var(--shiki-color-text)">))</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">#define</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">GPIOA_MODER</span><span style="color:var(--shiki-color-text)">     (</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">volatile</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">uint32_t</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">)(GPIOA_BASE_ADDR </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">00</span><span style="color:var(--shiki-color-text)">))</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">#define</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">GPIOA_ODR</span><span style="color:var(--shiki-color-text)">       (</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">volatile</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">uint32_t</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">)(GPIOA_BASE_ADDR </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">14</span><span style="color:var(--shiki-color-text)">))</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">void</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">delay</span><span style="color:var(--shiki-color-text)">() {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">for</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">volatile</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">uint32_t</span><span style="color:var(--shiki-color-text)"> i </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">; i </span><span style="color:var(--shiki-token-keyword)">&lt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">500000</span><span style="color:var(--shiki-color-text)">; i</span><span style="color:var(--shiki-token-keyword)">++</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-color-text)">() {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    RCC_AHB1ENR </span><span style="color:var(--shiki-token-keyword)">|=</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&lt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">); </span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    GPIOA_MODER </span><span style="color:var(--shiki-token-keyword)">&amp;=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">~</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&lt;</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">5</span><span style="color:var(--shiki-color-text)">));</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    GPIOA_MODER </span><span style="color:var(--shiki-token-keyword)">|=</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">0x</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&lt;</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">5</span><span style="color:var(--shiki-color-text)">));</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">while</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        GPIOA_ODR </span><span style="color:var(--shiki-token-keyword)">|=</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&lt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">5</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-function)">delay()</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        GPIOA_ODR </span><span style="color:var(--shiki-token-keyword)">&amp;=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">~</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&lt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">5</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-function)">delay()</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">; </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">extern</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">uint32_t</span><span style="color:var(--shiki-color-text)"> _stack;</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">__attribute__</span><span style="color:var(--shiki-color-text)"> ((</span><span style="color:var(--shiki-token-function)">section</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;.vectors&quot;</span><span style="color:var(--shiki-color-text)">))) </span><span style="color:var(--shiki-token-keyword)">void</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">vectors</span><span style="color:var(--shiki-token-keyword)">[]</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-color-text)">_stack</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-color-text)">main</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">};</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p><strong>The linker file is the most important file apart from your program, as it will make the difference between running and not running your program on your device.</strong> The linker script used is mentioned below:</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="text" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="text" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">MEMORY</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	FLASH (rx) : ORIGIN = 0x08000000, LENGTH = 128K</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	SRAM (rw) : ORIGIN = 0x20000000, LENGTH = 20K</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)"></span></span>
<span class="line"><span style="color:var(--shiki-color-text)">ENTRY(main)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)"></span></span>
<span class="line"><span style="color:var(--shiki-color-text)">SECTIONS</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    _stext_ = .;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	.text : {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		*(.vectors)	/* Vector table */</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		*(.text*)	/* Program code */</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		. = ALIGN(4);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		*(.rodata*)	/* Read-only data */</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		. = ALIGN(4);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	} &gt;FLASH</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    _etext_ = .;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)"></span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    _sdata_ = .;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	.data : {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		_data = .;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		*(.data*)	/* Read-write initialized data */</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		. = ALIGN(4);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		_edata = .;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	} &gt;FLASH AT &gt;SRAM</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    _edata_ = .;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)"></span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    _sbss_ = .;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	.bss : {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		*(.bss*)	/* Read-write zero initialized data */</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		. = ALIGN(4);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		_ebss = .;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	} &gt;SRAM</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    _ebss_ = .;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)"></span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	. = ALIGN(4);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	_estack = .;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)"></span></span>
<span class="line"><span style="color:var(--shiki-color-text)">PROVIDE(_stack = ORIGIN(SRAM) + LENGTH(SRAM));</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p><strong>NOTE: C++ is annoying unlike C, and needs some extra memory sections to be present in the linker script.</strong></p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="sh" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="sh" data-theme="default"><span class="line"><span style="color:var(--shiki-token-function)">arm-none-eabi-gcc</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-g</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-S</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-mcpu=cortex-m4</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-mthumb</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-mfloat-abi=hard</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">main.c</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-o</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">main.s</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">arm-none-eabi-as</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-g</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-mcpu=cortex-m4</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-mthumb</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-mfloat-abi=hard</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">main.s</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-o</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">main.o</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">arm-none-eabi-ld</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-g</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-T</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">link.ld</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">main.o</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-o</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">main.elf</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">arm-none-eabi-objcopy</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">-O</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">binary</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">main.elf</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">main.bin</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p><strong>NOTE: Not all the commands above are needed, the first three can be clubbed together into <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">arm-none-eabi-gcc</code>, but they&#x27;re shown separate to know the internals.</strong></p><p>Then connect the STLINK/V2-1 programmer/debugger with the board. In the case of the Nucleo target board, I just have to connect it through mini-USB, as the board has the programmer built-in.</p><div class="nx-not-prose"><div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="sh" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="sh" data-theme="default"><span class="line"><span style="color:var(--shiki-token-function)">st-flash</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">write</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string)">main.bin</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0x08000000</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div></div><p>Debugging the application while it’s executing on the board is a different task altogether.</p></div><p>MIT 2024 © resyfer.</p></article></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/embedded/blinky_scratch","query":{},"buildId":"x4tWifcy7VyKappZHO2tO","assetPrefix":"/blogs","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>